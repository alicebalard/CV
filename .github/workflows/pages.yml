
name: Build CV and deploy website

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

# Required permissions for GitHub Pages deployment (least privilege)
# - pages:write + id-token:write are needed by actions/deploy-pages
# - contents:read is enough for checkout
permissions:
  contents: read
  pages: write
  id-token: write

# Prevent overlapping deployments
concurrency:
  group: "pages"
  cancel-in-progress: true

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deploy.outputs.page_url }}

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      # --- Compile LaTeX to PDF ---
      - name: Compile LaTeX (cv.tex â†’ cv.pdf)
        uses: xu-cheng/latex-action@v4
        with:
          root_file: cv.tex
          # uncomment if you use fonts that require XeLaTeX
          # latexmk_use_xelatex: true

      # --- Prepare website files in ./dist ---
      - name: Prepare site
        run: |
          mkdir -p dist
          # move the freshly built PDF into the site folder
          cp cv.pdf dist/cv.pdf

          # create index.html that displays the PDF and provides a download link
          cat > dist/index.html << 'HTML'
          <!DOCTYPE html>
          <html lang="en">
            <head>
              <meta charset="utf-8" />
              <meta name="viewport" content="width=device-width, initial-scale=1" />
              <title>CV â€” Alice Balard</title>
              <style>
                html, body { height: 100%; margin: 0; }
                .wrap { min-height: 100vh; display: flex; flex-direction: column; }
                .viewer { flex: 1 1 auto; }
                .footer { padding: 1rem; text-align: center; font: 16px/1.4 system-ui, sans-serif; }
                .btn {
                  display: inline-block; padding: .6rem 1rem; border-radius: 6px;
                  background: #0969da; color: #fff; text-decoration: none;
                }
              </style>
            </head>
            <body>
              <div class="wrap">
                <!-- Inline PDF viewer -->
                <div class="viewer">
                  <object
                    data="cv.pdf#view=FitH"
                    type="application/pdf"
                    width="100%"
                    height="100%">
                    <iframe src="cv.pdf#view=FitH" width="100%" height="100%"></iframe>
                    <!-- Fallback -->
                    <p style="padding:1rem">
                      Your browser canâ€™t display PDFs inline.
                      Please <a href="cv.pdf">download the CV</a>.
                    </p>
                  </object>
                </div>

                <!-- Download button -->
                <div class="footer">
                  <a class="btn" href="cv.pdf" download>ðŸ“„ Download CV (PDF)</a>
                </div>
              </div>
            </body>
          </html>
          HTML

      # --- Upload the site as a Pages artifact ---
             with:
          path: dist

      # --- Deploy to GitHub Pages ---
      - name: Deploy to GitHub Pages
        id: deploy
        uses: actions/deploy-pages@v4
